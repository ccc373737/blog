# Rollup

- 链上扩容 / Layer1 一层扩容：即对区块链本身进行改造，从而直接提升链上交易处理速度 ：直接增加链上区块内可以包含的交易数量（ 如隔离见证 、扩块）、直接改变区块链的链体结构（ 如分片 Sharding 、有向无环图 DAG ）、直接改变区块链的共识机制（ 如 EOS 的 DPoS 、Solana 的 PoH ）等方案。
- 链下扩容 / Layer2 二层扩容：即将链上的相当一部分工作量转移到链下来完成，从而间接提升链上交易处理速度。

以太坊本身就是一颗状态树，记录所有账户信息。一笔交易可以从状态A转移到状态B，只是计算状态转移的过程相当复杂，并需要全网验证，因此限制的tps。

二层扩容基本思路就是将计算状态过程放在链下，并提供给链上可以简化验证成本的工具。具体来说，二层要做如下的事：

- 首先要确保 transaction 的合法性，这一点和layer1一样。
- 二层的 Relayer（ 暂时理解成节点 ）执行该 transaction，修改 Merkle Tree 中的转出账户和转入账户的叶子节点余额，然后重新计算新的状态树的根 Merkle Tree Root。
- 重复过程二，并合并多个交易，最后提交总的Merkle Tree Root。

二层提交的时候会将Merkle Tree Root和所有交易数据一并提交，但链上不需要重复验证过程，而是使用其他思路验证Merkle Tree Root的正确性。注：二层扩容方案并不会解决空间占有资源的问题，如有1000笔交易，链上还是需要记录1000笔交易，二层扩容方案解决的是计算成本高的问题，消耗的gas是原来一笔交易的几十或者100分之一，在最理想的状况下，也能将输出速率提高几十到200倍。

1. zkRollup方案：验证节点在链下通过零知识证明算法，生成一个证明P并与状态A，B与交易TX一起上传上链，相当于是表示“状态A在经过这些交易TX之后会变成状态B，你可以通过验证P来证实这一点”。

> 零知识证明：将函数的输入、计算过程和输出结果构建成多项式（零知识），通过多项式可以生成 Proof（零知识证明），验证者不需要了解所有数据，可以通过 Proof 验证函数的输入、计算过程和输出结果的正确性。
> 

2. Optimistic Rollup：有一个或者几个验证者，他们通过签名的方式担保“状态A在经过这些交易TX之后会变成状态B，我验证了”。然后，在一段时间的挑战期（通常是一周或者两周）之内，如果有人提出“你担保的结果和实际交易执行的结果不符”并提供证据，那么，错误的结果将会被回滚，挑战者可以获得担保人在链上抵押的一部分押金。通过激励模式保证可靠性。
